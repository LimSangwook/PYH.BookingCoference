<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="RESERVE">
	
    <typeAlias alias="reserve" type="com.module.reserve.dto.ReserveDto"/>

	
    <sql id="reserveColumn">
    	EVENT_NAME
    ,	TURN_NUM
    ,	EVENT_YEAR
    ,	PERIOD
    ,   LOCATION
    ,	HOST_NAME
    ,	ORGANIZE_NAME
    ,	MASTER_IMAGE
    ,	ORDER_LEVEL
    ,	STATUS
    ,	BOARD_SEARCH_START_DAY
    ,	BOARD_SEARCH_END_DAY
    ,	REG_DATE
    </sql>
    
    <sql id="speakerColumn">
        SPEAKER_KEY
    ,	RESERVE_KEY
    ,	KIND
    ,	SPEAKER_KIND_DETAIL
    ,	NAME
    ,	COUNTRY
    ,	BELONG
    ,	SUBJECT
    ,	CONTENT
    ,	PROFILE_PHOTO
    ,	ORDER_LEVEL
    ,	STATUS    	    
    </sql>
    
    <sql id="speakerSearch">        
        <dynamic>
            <isEqual prepend="AND" property="search_type" compareValue="1">
                STATUS IN ('Y','N')                
            </isEqual>
            <isEqual prepend="AND" property="search_type" compareValue="2">
                STATUS = 'Y'
            </isEqual>
            <isNotEmpty prepend="AND" property="kind">
                KIND = #kind#                
            </isNotEmpty>    
             
            <isNotEmpty prepend="AND" property="search_keyword">
				<isEqual property="search_column" compareValue="1">
					NAME LIKE #db_search_keyword#
				</isEqual>
			</isNotEmpty>			
        </dynamic>        
    </sql>
    
    <insert id="insertReserveInfo">
    /* RESERVE.insertReserveInfo */
    
    INSERT INTO RESERVE_INFO
    (    	
    	EVENT_NAME
    ,	TURN_NUM
    ,	EVENT_YEAR
    ,	PERIOD
    ,   LOCATION
    ,	HOST_NAME
    ,	ORGANIZE_NAME
    ,	MASTER_IMAGE
    ,	ORDER_LEVEL
    ,	STATUS
    ,	BOARD_SEARCH_START_DAY
    ,	BOARD_SEARCH_END_DAY
    ,	REG_DATE
    ,	MOD_DATE
    ) VALUES (
    	#event_name#
    ,	#turn_num#
    ,	#event_year#
    ,	#period#
    ,   #location#
    ,	#host_name#
    ,	#organize_name#
    ,	#master_image#
    ,	#order_level#
    ,	#status#
    ,	#board_search_start_day#
    ,	#board_search_end_day#
    ,	NOW()
    ,	NOW()
    )   
    	<selectKey resultClass="int" >
		SELECT @@IDENTITY AS RESERVE_KEY
		</selectKey>
	
    </insert>
    
    <update id="updateReserveInfo">
    /* RESERVE.updateReserveInfo */
    
    UPDATE RESERVE_INFO SET
    	MOD_DATE = NOW()
    ,	EVENT_NAME = #event_name#
    ,	TURN_NUM = #turn_num#
    ,	EVENT_YEAR = #event_year#
    ,	PERIOD = #period#
    ,   LOCATION = #location#
    ,	HOST_NAME = #host_name#
    ,	ORGANIZE_NAME = #organize_name#
    ,	MASTER_IMAGE = #master_image#
    ,	ORDER_LEVEL = #order_level#
    ,	STATUS = #status#
    ,	BOARD_SEARCH_START_DAY = #board_search_start_day#
    ,	BOARD_SEARCH_END_DAY = #board_search_end_day#		    
    WHERE RESERVE_KEY = #reserve_key#    
    </update>
    
    <insert id="insertReserveCont">
    /* RESERVE.insertReserveCont */
    
    INSERT INTO RESERVE_CONTENT
    (
    	RESERVE_KEY
    ,	CONTENT1
    ,	CONTENT2
    ,	CONTENT3
    ,	CONTENT4	
    ) VALUES (
    	#forum_key#
    ,	#content1#
    ,	#content2#
    ,	#content3#
    ,	#content4#
    ) ON DUPLICATE KEY UPDATE
    	RESERVE_KEY = #reserve_key#
    ,	CONTENT1 = #content1#
    ,	CONTENT2 = #content2#
    ,	CONTENT3 = #content3#
    ,	CONTENT4 = #content4#
    </insert>
    
    <select id="getReserveInfo" resultClass="reserve">
    /* RESERVE.getReserveInfo */    
    
    SELECT 
    	<include refid="reserveColumn"/>
    ,	A.RESERVE_KEY
    ,	B.CONTENT1
    ,	B.CONTENT2
    ,	B.CONTENT3
    ,	B.CONTENT4	 
    FROM RESERVE_INFO AS A, FORUM_CONTENT AS B
    WHERE A.FORUM_KEY = B.FORUM_KEY
    AND A.FORUM_KEY = #forum_key#
    </select>
    
    <select id="getForumActiveInfo" resultClass="forum">
    /* FORUM.getForumActiveInfo */    
    
    SELECT 
    	<include refid="forumColumn"/>
    ,	A.FORUM_KEY
    ,	B.CONTENT1
    ,	B.CONTENT2
    ,	B.CONTENT3
    ,	B.CONTENT4	 
    FROM FORUM_INFO AS A, FORUM_CONTENT AS B
    WHERE A.FORUM_KEY = B.FORUM_KEY
    AND A.STATUS = '1'
    ORDER BY ORDER_LEVEL
    LIMIT 0, 1
    </select>
    
    <select id="getForumList" resultClass="forum">
    /* FORUM.getForumList */
    
    SELECT FORUM_KEY, <include refid="forumColumn"/> FROM FORUM_INFO
    WHERE 1=1
    	<dynamic>
    	    <isEqual prepend="AND" property="search_type" compareValue="1">    	        
    	        STATUS IN ('1','2','3')
    	    </isEqual>
    	    
    	    <isEqual prepend="AND" property="search_type" compareValue="2">
    	        STATUS IN ('2')    	        
    	    </isEqual>    	    
    	</dynamic>
	ORDER BY ORDER_LEVEL    	
    </select>
    
    <update id="deleteForumInfo">
    /* FORUM.deleteForumInfo */
    
    UPDATE FORUM_INFO SET
    	MOD_DATE = NOW()
    ,	STATUS = '4'
    WHERE FORUM_KEY = #forum_key#
    </update>
    
 
    
    
    
</sqlMap>